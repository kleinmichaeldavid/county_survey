---
output:
  pdf_document:
    number_sections: false
header-includes:
- \usepackage{booktabs}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning=FALSE, message=FALSE, show=FALSE, echo=FALSE)
```

```{r}

depo <- "Library Services"
```

```{r}
library(tidyverse)
library(ggplot2)
## read data
responses1 <- read.csv('survey_responses1.csv', encoding = "UTF-8"); names(responses1) <- gsub("X[0-9]*\\.\\.","", names(responses1))
responses2 <- read.csv('survey_responses2.csv', encoding = "UTF-8"); names(responses2) <- gsub("X[0-9]*\\.\\.","", names(responses2))
responses3 <- read.csv('survey_responses3.csv', encoding = "UTF-8"); names(responses3) <- gsub("X[0-9]*\\.\\.","", names(responses3))
responses4 <- read.csv('survey_responses4.csv', encoding = "UTF-8"); names(responses4) <- gsub("X[0-9]*\\.\\.","", names(responses4))
responses5 <- read.csv('survey_responses5.csv', encoding = "UTF-8"); names(responses5) <- gsub("X[0-9]*\\.\\.","", names(responses5))
responses5 <- responses5[,-which(names(responses5) == "Comments..optional...107")] ## temp since 23 is duplicated

## merge data and separate survey from demog
all_responses <- rbind(responses1, responses2, responses3, responses4, responses5)
codes <- read.table("codes.txt")$V1
all_responses <- all_responses[all_responses[,2] %in% codes,]
ids <- all_responses[,2]
all_responses <- all_responses[,-c(1,2,grep("Comments", names(all_responses)))]
survey_responses <- all_responses[,1:107]
demog_responses <- all_responses[,108:112]

## clean up question strings
questions <- gsub("\\."," ",names(survey_responses)) %>% trimws()
names(survey_responses) <- questions
```

```{r}
## read the category types
categories <- read.csv('question_categories.csv', sep = "\t")
categories$question <- gsub("[^A-Za-z ]"," ",categories$question) %>% trimws() ### if prob here, its likely due to quote - replace with curvies
categories <- categories[match(names(survey_responses), categories$question),] ## re-order to math survey df
```

```{r}
better_cat_names <- data.frame(bad = c('meaning', 'ethics', 'safety', 'learning',
                                        'teamwork', 'recognition', 'leadership',
                                        'management', 'culture', 'conflict', 'commitment',
                                        'pay', 'support', 'communication', 'balance'),
                               good = c('Meaningful Work & Purpose',
                                         'Conduct / Ethics',
                                         'Health & Safety',
                                         'Learning & Development',
                                         'Teamwork', 'Recognition', 'Leadership (SMT)',
                                         'Management Effectiveness',
                                         'Culture', 'Conflict Resolution',
                                         'Service Commitment',
                                         'Pay & Benefits', 'Resources / Support',
                                         'Communication', 'Work / Life Balance'))
categories$category <- better_cat_names$good[match(categories$category, better_cat_names$bad)]



## tidying demographic info
demog_qs <- c("When.were.you.born.", "What.department.are.you.in.",
              "How.long.have.you.been.an.employee.of.L.A.County.", "What.type.of.position.are.you.in.",
              "What.is.your.employment.status.")
demog_qs_df <- data.frame(names = demog_qs,
                          questions = gsub("\\."," ",demog_qs) %>% trimws() %>% paste("?",sep=""),
                          code = c("birth","department","duration","position","status"))
names(demog_responses) <- demog_qs_df$code[match(names(demog_responses), demog_qs_df$names)]
demog_responses$department[demog_responses$department == "Human Resources"] <- "Administration & Human Resources"

## set up question number to category mapping
categories$q_nums <- paste("q", 1:107, sep="_")
names(survey_responses) <- paste("q", 1:107, sep="_")

## transpose
df_resps <- cbind(survey_responses, demog_responses) %>% as.matrix() %>% t() %>% as.data.frame()
df_resps$category <- c(as.character(categories$category[match(categories$q_nums, row.names(df_resps))]),
                       rep('demog', 5))


long_data <- data.frame()
for (n in 1:(ncol(df_resps)-1)) {
  qs <- data.frame(emp = n, question = categories$question, category = df_resps[1:107,"category"], response = df_resps[1:107,n])
  demogs <- df_resps[108:112,n] %>% as.character() %>% rep(107) %>% matrix(ncol = 5, byrow = TRUE) %>% as.data.frame()
  names(demogs) <- c("birth", "department", "duration", "position", "status")
  new_long <- cbind(qs, demogs)
  long_data <- plyr::rbind.fill(long_data, new_long)
}

```

```{r}
#################################################
#### OVERALL SUMMARY VIZZES 
############################################

source('organization_functions.R')
source('viz_functions.R')

#### version with 1 row = 1 person

df_tidy <- cbind(survey_responses, demog_responses)

for (demog in c('birth', 'department', 'duration', 'position', 'status')){
  df_tidy[,demog] <- as.character(df_tidy[,demog])
  df_tidy[df_tidy[,demog] == "",demog] <- "<no response>"
  df_tidy[,demog] <- as.factor(df_tidy[,demog])
}

df_tidy_all <- df_tidy
if (!is.null(depo)) {
  df_tidy <- df_tidy[df_tidy$department == depo,]
}

col_cats_all <- categories$category[match(names(df_tidy_all), categories$q_nums)]
col_cats <- categories$category[match(names(df_tidy), categories$q_nums)]
cats <- unique(categories$category)


## summarize the tidy data into categories
## sort the rows and columns
df_cat_means_by_emp_all <- category_means_from_tidy(df_tidy_all, categories, 'department')
df_cat_means_by_dep_all <- group_means_for_categories(df_cat_means_by_emp_all, 'group')
categories_best_to_worst_all <- determine_column_order(df_cat_means_by_dep_all, 3:17, decreasing = TRUE)
categories_worst_to_best_all <- determine_column_order(df_cat_means_by_dep_all, 3:17, decreasing = FALSE)
departments_best_to_worst_all <- determine_row_order(df_cat_means_by_dep_all, 'group', 3:17, TRUE)
departments_worst_to_best_all <- determine_row_order(df_cat_means_by_dep_all, 'group', 3:17, FALSE)
df_cat_means_by_dep_all <- sort_columns(df_cat_means_by_dep_all, 3:17, categories_worst_to_best_all)
df_cat_means_by_dep_all <- sort_rows(df_cat_means_by_dep_all, 'group', departments_best_to_worst_all)

df_cat_means_by_emp <- category_means_from_tidy(df_tidy, categories, 'department')
df_cat_means_by_dep <- group_means_for_categories(df_cat_means_by_emp, 'group')
categories_best_to_worst <- determine_column_order(df_cat_means_by_dep, 3:17, decreasing = TRUE)
categories_worst_to_best <- determine_column_order(df_cat_means_by_dep, 3:17, decreasing = FALSE)
departments_best_to_worst <- determine_row_order(df_cat_means_by_dep, 'group', 3:17, TRUE)
departments_worst_to_best <- determine_row_order(df_cat_means_by_dep, 'group', 3:17, FALSE)
df_cat_means_by_emp <- sort_columns(df_cat_means_by_emp, 3:17, categories_worst_to_best)
df_cat_means_by_emp <- sort_rows(df_cat_means_by_emp, 'group', departments_best_to_worst)

## get cat means for demogs other than department
df_cat_means_by_pos <- group_means_for_categories(category_means_from_tidy(df_tidy,
                                                                           categories,
                                                                           'position'),'group')
positions_best_to_worst <- determine_row_order(df_cat_means_by_pos, 'group', 3:17, TRUE)
df_cat_means_by_pos <- sort_columns(df_cat_means_by_pos, 3:17, categories_worst_to_best)
df_cat_means_by_pos <- sort_rows(df_cat_means_by_pos, 'group', positions_best_to_worst)

df_cat_means_by_emp <- group_means_for_categories(category_means_from_tidy(df_tidy,
                                                                           categories,
                                                                           'status'), 'group')
statuses_best_to_worst <- determine_row_order(df_cat_means_by_emp, 'group', 3:17, TRUE)
df_cat_means_by_emp <- sort_columns(df_cat_means_by_emp, 3:17, categories_worst_to_best)
df_cat_means_by_emp <- sort_rows(df_cat_means_by_emp, 'group', statuses_best_to_worst)


df_cat_means_by_len <- group_means_for_categories(category_means_from_tidy(df_tidy,
                                                                           categories,
                                                                           'duration'), 'group')
length_order <- c("<no response>", "30 or more years", "20 to 29 years",
                  "10 to 19 years", "1 to 9 years", "less than 1 year")
df_cat_means_by_len <- sort_columns(df_cat_means_by_len, 3:17, categories_worst_to_best)
df_cat_means_by_len <- sort_rows(df_cat_means_by_len, 'group', rev(length_order))


df_cat_means_by_gen <- group_means_for_categories(category_means_from_tidy(df_tidy,
                                                                           categories,
                                                                           'birth'), 'group')
generation_order <- c("<no response>", "1946 to 1964", "1965 to 1976", "1977 to 1995", "1996 or later")
df_cat_means_by_gen <- sort_columns(df_cat_means_by_gen, 3:17, categories_worst_to_best)
df_cat_means_by_gen <- sort_rows(df_cat_means_by_gen, 'group', rev(generation_order))

## get counts for histograms and stacked bars
df_counts_all <- counts_from_tidy(df_tidy_all, proportions = FALSE)
df_props_all <- counts_from_tidy(df_tidy_all, proportions = TRUE)
df_count_cats_all <- question_counts_to_categories(df_counts_all, categories)
df_count_cats_all <- sort_columns(df_count_cats_all, 2:16, categories_worst_to_best)
category_scores <- colSums(df_count_cats_all[,2:16] * 1:5)

df_counts <- counts_from_tidy(df_tidy, proportions = FALSE)
df_props <- counts_from_tidy(df_tidy, proportions = TRUE)
df_count_cats <- question_counts_to_categories(df_counts, categories)
df_count_cats <- sort_columns(df_count_cats, 2:16, categories_worst_to_best)

######## RESPONDENT DEMOGRAPHICS

# department
department_resps <- demog_responses %>% group_by(department) %>%
  summarize(n = n()) %>% as.data.frame()
names(department_resps) <- c("Department", "Count")
department_resps$Department <- as.character(department_resps$Department)
department_resps$Department[department_resps$Department == ""] <- "/No Response Provided/"
department_resps <- department_resps[order(department_resps$Count,
                                           decreasing = TRUE),]
row.names(department_resps) <- department_resps$Department
department_resps$Department <- NULL

# position
position_resps <- demog_responses %>% group_by(position) %>%
  summarize(n = n()) %>% as.data.frame()
names(position_resps) <- c("Position", "Count")
position_resps$Position <- as.character(position_resps$Position)
position_resps$Position[position_resps$Position == ""] <- "/No Response Provided/"
position_resps <- position_resps[order(position_resps$Count,
                                           decreasing = TRUE),]
row.names(position_resps) <- position_resps$Position
position_resps$Position <- NULL

# status
status_resps <- demog_responses %>% group_by(status) %>%
  summarize(n = n()) %>% as.data.frame()
names(status_resps) <- c("Status", "Count")
status_resps$Status <- as.character(status_resps$Status)
status_resps$Status[status_resps$Status == ""] <- "/No Response Provided/"
status_resps <- status_resps[order(status_resps$Count,
                                           decreasing = TRUE),]
row.names(status_resps) <- status_resps$Status
status_resps$Status <- NULL

# duration
duration_resps <- demog_responses %>% group_by(duration) %>%
  summarize(n = n()) %>% as.data.frame()
names(duration_resps) <- c("Duration", "Count")
duration_resps$Duration <- as.character(duration_resps$Duration)
duration_resps$Duration[duration_resps$Duration == ""] <- "/No Response Provided/"
duration_resps <- duration_resps[order(duration_resps$Count,
                                           decreasing = TRUE),]
row.names(duration_resps) <- duration_resps$Duration
duration_resps$Duration <- NULL

# birth
birth_resps <- demog_responses %>% group_by(birth) %>%
  summarize(n = n()) %>% as.data.frame()
names(birth_resps) <- c("Birth", "Count")
birth_resps$Birth <- as.character(birth_resps$Birth)
birth_resps$Birth[birth_resps$Birth == ""] <- "/No Response Provided/"
birth_resps <- birth_resps[order(birth_resps$Count,
                                           decreasing = TRUE),]
row.names(birth_resps) <- birth_resps$Birth
birth_resps$Birth <- NULL

```



\centering  
![](logo.png)  
\Huge  
Library Services Results  
\LARGE  
[Redacted] County Employee Engagement Survey  
\Large  
January 10th, 2019  
\normalsize   
\raggedright  
\newpage

\tableofcontents  
\newpage


\centering  

# Results Overview (25 respondents)

\raggedright  

**Employees' agreement and disagreement with each category.**

```{r, fig.height = 1.3}
## for categories
melted_cat_counts <- reshape2::melt(df_count_cats, id = 'response')
output <- plot_strengths_and_weaknesses(melted_cat_counts, by_question = FALSE, type = "categories")
```

**Average response profile across all categories.**
**Lines represent the range of individual categories.**

```{r, fig.height = 1.9}

title <- "no title"

df_counts_all <- data.frame(response = 1:5,
                            value = rowSums(df_counts[,2:ncol(df_counts)])/sum(rowSums(df_counts[,2:ncol(df_counts)])),
                            variable = title)

df_count_cats_error_bars <- data.frame(response = 1:5,
                                       min = df_count_cats[2:ncol(df_count_cats)] %>%
                                         as.matrix() %>% matrixStats::rowMins(),
                                       max = df_count_cats[2:ncol(df_count_cats)] %>%
                                         as.matrix() %>% matrixStats::rowMaxs())

plot_histogram(1, df_counts_all, df_count_cats_error_bars, NULL, title)
```

**Response profile for each category.**

```{r, fig.align='center', fig.height = 3.9}
## potentially add overall as a top bar (in a new window thing?)
reversed_resps <- df_count_cats
reversed_resps$response <- 6 - reversed_resps$response
plot_stacked_bars(reversed_resps, ylab = "Proportion of employees giving each response")
```

\newpage


**Department response profile comparison to overall results. Within each category, the top bar represents the department and the bottom bar represents the overall results**
```{r, fig.align='center', fig.height = 7}
df_count_cats$type <- "department"
df_count_cats_all$type <- "company"
df_count_comparison <- rbind(df_count_cats, df_count_cats_all)

melted <- reshape2::melt(df_count_comparison, c("type", "response"))
melted[,"type"] <- factor(melted[,"type"],c("company", "department"))
melted[,"response"] <- factor(melted[,"response"],5:1)
melted[,"variable"] <- factor(melted[,"variable"],rev(unique(melted[,"variable"])))

ggplot(melted, aes(x = type, y = value, fill = response)) + 
  geom_bar(stat = 'identity', position = 'stack') +
    coord_flip() + facet_grid(rows = vars(variable), switch = "y") +
  theme(strip.text.y = element_text(angle = 180),
        panel.margin.x=unit(0.1, "lines"),
        legend.title = element_blank(),
        axis.ticks.y=element_blank(),
        axis.text.y=element_blank()) +
    scale_fill_manual(labels = c("strongly agree", "agree",
                                 "neutral",
                                 "disagree", "strongly disagree"),
                      values=c("#167a1c", "#6d9670",
                               "#efefef",
                               "#c17474", "#c11717")) +
    labs(title = NULL,
         y = "Proportion of employees giving each response",
         x = NULL)
```

\newpage

```{r}
var_counter <- 1
```

```{r}
var <- categories_best_to_worst[var_counter]; var_counter <- var_counter + 1
```

\centering  

# Results by Category

\raggedright  

\centering  

## `r var`

\raggedright  
**Employees' agreement and disagreement with each statement.**
```{r, fig.align='center', fig.height = 1.3, results='asis'}

melted_count_data <- melt_data(df_props, col_cats, categories, var)

outputs <- plot_strengths_and_weaknesses(melted_count_data)
ranked_questions <- outputs[[1]]
ns <- outputs[[2]]
```
**Average response profile across all statements in this category.**
**Lines represent the range of individual statements.**
```{r}
histo_error_bars <- melted_count_data %>% group_by(response) %>%
  summarize(min = min(value), max = max(value)) %>% as.data.frame()

plot_histogram_large(df_count_cats, histo_error_bars, var)
```
\newpage

```{r, results='asis'}
if(ns[1] > 0){cat(paste("**Clear Agreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[1], melted_count_data, var, ranked_questions)
```

```{r, results='asis'}
if(ns[2] > 0){cat(paste("**Slight Agreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[2], melted_count_data, var, ranked_questions, counter)
```

```{r, results='asis'}
if(ns[3] > 0){cat(paste("**Neutral** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[3], melted_count_data, var, ranked_questions, counter)
```

```{r, results='asis'}
if(ns[4] > 0){cat(paste("**Slight Disagreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[4], melted_count_data, var, ranked_questions, counter)
```

```{r, results='asis'}
if(ns[5] > 0){cat(paste("**Clear Disagreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[5], melted_count_data, var, ranked_questions, counter)
```

```{r}
var <- categories_best_to_worst[var_counter]; var_counter <- var_counter + 1
```

\newpage  

\centering  

\centering  

## `r var`

\raggedright  
**Employees' agreement and disagreement with each statement.**
```{r, fig.align='center', fig.height = 1.3, results='asis'}

melted_count_data <- melt_data(df_props, col_cats, categories, var)

outputs <- plot_strengths_and_weaknesses(melted_count_data)
ranked_questions <- outputs[[1]]
ns <- outputs[[2]]
```
**Average response profile across all statements in this category.**
**Lines represent the range of individual statements.**
```{r}
histo_error_bars <- melted_count_data %>% group_by(response) %>%
  summarize(min = min(value), max = max(value)) %>% as.data.frame()

plot_histogram_large(df_count_cats, histo_error_bars, var)
```
\newpage

```{r, results='asis'}
if(ns[1] > 0){cat(paste("**Clear Agreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[1], melted_count_data, var, ranked_questions)
```

```{r, results='asis'}
if(ns[2] > 0){cat(paste("**Slight Agreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[2], melted_count_data, var, ranked_questions, counter)
```

```{r, results='asis'}
if(ns[3] > 0){cat(paste("**Neutral** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[3], melted_count_data, var, ranked_questions, counter)
```

```{r, results='asis'}
if(ns[4] > 0){cat(paste("**Slight Disagreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[4], melted_count_data, var, ranked_questions, counter)
```

```{r, results='asis'}
if(ns[5] > 0){cat(paste("**Clear Disagreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[5], melted_count_data, var, ranked_questions, counter)
```

```{r}
var <- categories_best_to_worst[var_counter]; var_counter <- var_counter + 1
```

\newpage  

\centering  

## `r var`

\raggedright  
**Employees' agreement and disagreement with each statement.**
```{r, fig.align='center', fig.height = 1.3, results='asis'}

melted_count_data <- melt_data(df_props, col_cats, categories, var)

outputs <- plot_strengths_and_weaknesses(melted_count_data)
ranked_questions <- outputs[[1]]
ns <- outputs[[2]]
```
**Average response profile across all statements in this category.**
**Lines represent the range of individual statements.**
```{r}
histo_error_bars <- melted_count_data %>% group_by(response) %>%
  summarize(min = min(value), max = max(value)) %>% as.data.frame()

plot_histogram_large(df_count_cats, histo_error_bars, var)
```
\newpage

```{r, results='asis'}
if(ns[1] > 0){cat(paste("**Clear Agreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[1], melted_count_data, var, ranked_questions)
```

```{r, results='asis'}
if(ns[2] > 0){cat(paste("**Slight Agreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[2], melted_count_data, var, ranked_questions, counter)
```

```{r, results='asis'}
if(ns[3] > 0){cat(paste("**Neutral** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[3], melted_count_data, var, ranked_questions, counter)
```

```{r, results='asis'}
if(ns[4] > 0){cat(paste("**Slight Disagreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[4], melted_count_data, var, ranked_questions, counter)
```

```{r, results='asis'}
if(ns[5] > 0){cat(paste("**Clear Disagreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[5], melted_count_data, var, ranked_questions, counter)
```

```{r}
var <- categories_best_to_worst[var_counter]; var_counter <- var_counter + 1
```

\newpage  

\centering  

## `r var`

\raggedright  
**Employees' agreement and disagreement with each statement.**
```{r, fig.align='center', fig.height = 1.3, results='asis'}

melted_count_data <- melt_data(df_props, col_cats, categories, var)

outputs <- plot_strengths_and_weaknesses(melted_count_data)
ranked_questions <- outputs[[1]]
ns <- outputs[[2]]
```
**Average response profile across all statements in this category.**
**Lines represent the range of individual statements.**
```{r}
histo_error_bars <- melted_count_data %>% group_by(response) %>%
  summarize(min = min(value), max = max(value)) %>% as.data.frame()

plot_histogram_large(df_count_cats, histo_error_bars, var)
```
\newpage

```{r, results='asis'}
if(ns[1] > 0){cat(paste("**Clear Agreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[1], melted_count_data, var, ranked_questions)
```

```{r, results='asis'}
if(ns[2] > 0){cat(paste("**Slight Agreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[2], melted_count_data, var, ranked_questions, counter)
```

```{r, results='asis'}
if(ns[3] > 0){cat(paste("**Neutral** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[3], melted_count_data, var, ranked_questions, counter)
```

```{r, results='asis'}
if(ns[4] > 0){cat(paste("**Slight Disagreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[4], melted_count_data, var, ranked_questions, counter)
```

```{r, results='asis'}
if(ns[5] > 0){cat(paste("**Clear Disagreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[5], melted_count_data, var, ranked_questions, counter)
```

```{r}
var <- categories_best_to_worst[var_counter]; var_counter <- var_counter + 1
```

\newpage  

\centering  

## `r var`

\raggedright  
**Employees' agreement and disagreement with each statement.**
```{r, fig.align='center', fig.height = 1.3, results='asis'}

melted_count_data <- melt_data(df_props, col_cats, categories, var)

outputs <- plot_strengths_and_weaknesses(melted_count_data)
ranked_questions <- outputs[[1]]
ns <- outputs[[2]]
```
**Average response profile across all statements in this category.**
**Lines represent the range of individual statements.**
```{r}
histo_error_bars <- melted_count_data %>% group_by(response) %>%
  summarize(min = min(value), max = max(value)) %>% as.data.frame()

plot_histogram_large(df_count_cats, histo_error_bars, var)
```
\newpage

```{r, results='asis'}
if(ns[1] > 0){cat(paste("**Clear Agreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[1], melted_count_data, var, ranked_questions)
```

```{r, results='asis'}
if(ns[2] > 0){cat(paste("**Slight Agreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[2], melted_count_data, var, ranked_questions, counter)
```

```{r, results='asis'}
if(ns[3] > 0){cat(paste("**Neutral** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[3], melted_count_data, var, ranked_questions, counter)
```

```{r, results='asis'}
if(ns[4] > 0){cat(paste("**Slight Disagreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[4], melted_count_data, var, ranked_questions, counter)
```

```{r, results='asis'}
if(ns[5] > 0){cat(paste("**Clear Disagreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[5], melted_count_data, var, ranked_questions, counter)
```

```{r}
var <- categories_best_to_worst[var_counter]; var_counter <- var_counter + 1
```

\newpage  

\centering  

## `r var`

\raggedright  
**Employees' agreement and disagreement with each statement.**
```{r, fig.align='center', fig.height = 1.3, results='asis'}

melted_count_data <- melt_data(df_props, col_cats, categories, var)

outputs <- plot_strengths_and_weaknesses(melted_count_data)
ranked_questions <- outputs[[1]]
ns <- outputs[[2]]
```
**Average response profile across all statements in this category.**
**Lines represent the range of individual statements.**
```{r}
histo_error_bars <- melted_count_data %>% group_by(response) %>%
  summarize(min = min(value), max = max(value)) %>% as.data.frame()

plot_histogram_large(df_count_cats, histo_error_bars, var)
```
\newpage

```{r, results='asis'}
if(ns[1] > 0){cat(paste("**Clear Agreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[1], melted_count_data, var, ranked_questions)
```

```{r, results='asis'}
if(ns[2] > 0){cat(paste("**Slight Agreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[2], melted_count_data, var, ranked_questions, counter)
```

```{r, results='asis'}
if(ns[3] > 0){cat(paste("**Neutral** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[3], melted_count_data, var, ranked_questions, counter)
```

```{r, results='asis'}
if(ns[4] > 0){cat(paste("**Slight Disagreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[4], melted_count_data, var, ranked_questions, counter)
```

```{r, results='asis'}
if(ns[5] > 0){cat(paste("**Clear Disagreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[5], melted_count_data, var, ranked_questions, counter)
```

```{r}
var <- categories_best_to_worst[var_counter]; var_counter <- var_counter + 1
```

\newpage  

\centering  

## `r var`

\raggedright  
**Employees' agreement and disagreement with each statement.**
```{r, fig.align='center', fig.height = 1.3, results='asis'}

melted_count_data <- melt_data(df_props, col_cats, categories, var)

outputs <- plot_strengths_and_weaknesses(melted_count_data)
ranked_questions <- outputs[[1]]
ns <- outputs[[2]]
```
**Average response profile across all statements in this category.**
**Lines represent the range of individual statements.**
```{r}
histo_error_bars <- melted_count_data %>% group_by(response) %>%
  summarize(min = min(value), max = max(value)) %>% as.data.frame()

plot_histogram_large(df_count_cats, histo_error_bars, var)
```
\newpage

```{r, results='asis'}
if(ns[1] > 0){cat(paste("**Clear Agreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[1], melted_count_data, var, ranked_questions)
```

```{r, results='asis'}
if(ns[2] > 0){cat(paste("**Slight Agreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[2], melted_count_data, var, ranked_questions, counter)
```

```{r, results='asis'}
if(ns[3] > 0){cat(paste("**Neutral** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[3], melted_count_data, var, ranked_questions, counter)
```

```{r, results='asis'}
if(ns[4] > 0){cat(paste("**Slight Disagreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[4], melted_count_data, var, ranked_questions, counter)
```

```{r, results='asis'}
if(ns[5] > 0){cat(paste("**Clear Disagreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[5], melted_count_data, var, ranked_questions, counter)
```

```{r}
var <- categories_best_to_worst[var_counter]; var_counter <- var_counter + 1
```

\newpage  

\centering  

## `r var`

\raggedright  
**Employees' agreement and disagreement with each statement.**
```{r, fig.align='center', fig.height = 1.3, results='asis'}

melted_count_data <- melt_data(df_props, col_cats, categories, var)

outputs <- plot_strengths_and_weaknesses(melted_count_data)
ranked_questions <- outputs[[1]]
ns <- outputs[[2]]
```
**Average response profile across all statements in this category.**
**Lines represent the range of individual statements.**
```{r}
histo_error_bars <- melted_count_data %>% group_by(response) %>%
  summarize(min = min(value), max = max(value)) %>% as.data.frame()

plot_histogram_large(df_count_cats, histo_error_bars, var)
```
\newpage

```{r, results='asis'}
if(ns[1] > 0){cat(paste("**Clear Agreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[1], melted_count_data, var, ranked_questions)
```

```{r, results='asis'}
if(ns[2] > 0){cat(paste("**Slight Agreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[2], melted_count_data, var, ranked_questions, counter)
```

```{r, results='asis'}
if(ns[3] > 0){cat(paste("**Neutral** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[3], melted_count_data, var, ranked_questions, counter)
```

```{r, results='asis'}
if(ns[4] > 0){cat(paste("**Slight Disagreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[4], melted_count_data, var, ranked_questions, counter)
```

```{r, results='asis'}
if(ns[5] > 0){cat(paste("**Clear Disagreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[5], melted_count_data, var, ranked_questions, counter)
```

```{r}
var <- categories_best_to_worst[var_counter]; var_counter <- var_counter + 1
```

\newpage  

\centering  

## `r var`

\raggedright  
**Employees' agreement and disagreement with each statement.**
```{r, fig.align='center', fig.height = 1.3, results='asis'}

melted_count_data <- melt_data(df_props, col_cats, categories, var)

outputs <- plot_strengths_and_weaknesses(melted_count_data)
ranked_questions <- outputs[[1]]
ns <- outputs[[2]]
```
**Average response profile across all statements in this category.**
**Lines represent the range of individual statements.**
```{r}
histo_error_bars <- melted_count_data %>% group_by(response) %>%
  summarize(min = min(value), max = max(value)) %>% as.data.frame()

plot_histogram_large(df_count_cats, histo_error_bars, var)
```
\newpage

```{r, results='asis'}
if(ns[1] > 0){cat(paste("**Clear Agreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[1], melted_count_data, var, ranked_questions)
```

```{r, results='asis'}
if(ns[2] > 0){cat(paste("**Slight Agreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[2], melted_count_data, var, ranked_questions, counter)
```

```{r, results='asis'}
if(ns[3] > 0){cat(paste("**Neutral** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[3], melted_count_data, var, ranked_questions, counter)
```

```{r, results='asis'}
if(ns[4] > 0){cat(paste("**Slight Disagreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[4], melted_count_data, var, ranked_questions, counter)
```

```{r, results='asis'}
if(ns[5] > 0){cat(paste("**Clear Disagreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[5], melted_count_data, var, ranked_questions, counter)
```

```{r}
var <- categories_best_to_worst[var_counter]; var_counter <- var_counter + 1
```

\newpage  

\centering  

## `r var`

\raggedright  
**Employees' agreement and disagreement with each statement.**
```{r, fig.align='center', fig.height = 1.3, results='asis'}

melted_count_data <- melt_data(df_props, col_cats, categories, var)

outputs <- plot_strengths_and_weaknesses(melted_count_data)
ranked_questions <- outputs[[1]]
ns <- outputs[[2]]
```
**Average response profile across all statements in this category.**
**Lines represent the range of individual statements.**
```{r}
histo_error_bars <- melted_count_data %>% group_by(response) %>%
  summarize(min = min(value), max = max(value)) %>% as.data.frame()

plot_histogram_large(df_count_cats, histo_error_bars, var)
```
\newpage

```{r, results='asis'}
if(ns[1] > 0){cat(paste("**Clear Agreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[1], melted_count_data, var, ranked_questions)
```

```{r, results='asis'}
if(ns[2] > 0){cat(paste("**Slight Agreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[2], melted_count_data, var, ranked_questions, counter)
```

```{r, results='asis'}
if(ns[3] > 0){cat(paste("**Neutral** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[3], melted_count_data, var, ranked_questions, counter)
```

```{r, results='asis'}
if(ns[4] > 0){cat(paste("**Slight Disagreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[4], melted_count_data, var, ranked_questions, counter)
```

```{r, results='asis'}
if(ns[5] > 0){cat(paste("**Clear Disagreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[5], melted_count_data, var, ranked_questions, counter)
```

```{r}
var <- categories_best_to_worst[var_counter]; var_counter <- var_counter + 1
```

\newpage  

\centering  

## `r var`

\raggedright  
**Employees' agreement and disagreement with each statement.**
```{r, fig.align='center', fig.height = 1.3, results='asis'}

melted_count_data <- melt_data(df_props, col_cats, categories, var)

outputs <- plot_strengths_and_weaknesses(melted_count_data)
ranked_questions <- outputs[[1]]
ns <- outputs[[2]]
```
**Average response profile across all statements in this category.**
**Lines represent the range of individual statements.**
```{r}
histo_error_bars <- melted_count_data %>% group_by(response) %>%
  summarize(min = min(value), max = max(value)) %>% as.data.frame()

plot_histogram_large(df_count_cats, histo_error_bars, var)
```
\newpage

```{r, results='asis'}
if(ns[1] > 0){cat(paste("**Clear Agreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[1], melted_count_data, var, ranked_questions)
```

```{r, results='asis'}
if(ns[2] > 0){cat(paste("**Slight Agreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[2], melted_count_data, var, ranked_questions, counter)
```

```{r, results='asis'}
if(ns[3] > 0){cat(paste("**Neutral** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[3], melted_count_data, var, ranked_questions, counter)
```

```{r, results='asis'}
if(ns[4] > 0){cat(paste("**Slight Disagreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[4], melted_count_data, var, ranked_questions, counter)
```

```{r, results='asis'}
if(ns[5] > 0){cat(paste("**Clear Disagreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[5], melted_count_data, var, ranked_questions, counter)
```

```{r}
var <- categories_best_to_worst[var_counter]; var_counter <- var_counter + 1
```

\newpage  

\centering  

## `r var`

\raggedright  
**Employees' agreement and disagreement with each statement.**
```{r, fig.align='center', fig.height = 1.3, results='asis'}

melted_count_data <- melt_data(df_props, col_cats, categories, var)

outputs <- plot_strengths_and_weaknesses(melted_count_data)
ranked_questions <- outputs[[1]]
ns <- outputs[[2]]
```
**Average response profile across all statements in this category.**
**Lines represent the range of individual statements.**
```{r}
histo_error_bars <- melted_count_data %>% group_by(response) %>%
  summarize(min = min(value), max = max(value)) %>% as.data.frame()

plot_histogram_large(df_count_cats, histo_error_bars, var)
```
\newpage

```{r, results='asis'}
if(ns[1] > 0){cat(paste("**Clear Agreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[1], melted_count_data, var, ranked_questions)
```

```{r, results='asis'}
if(ns[2] > 0){cat(paste("**Slight Agreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[2], melted_count_data, var, ranked_questions, counter)
```

```{r, results='asis'}
if(ns[3] > 0){cat(paste("**Neutral** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[3], melted_count_data, var, ranked_questions, counter)
```

```{r, results='asis'}
if(ns[4] > 0){cat(paste("**Slight Disagreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[4], melted_count_data, var, ranked_questions, counter)
```

```{r, results='asis'}
if(ns[5] > 0){cat(paste("**Clear Disagreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[5], melted_count_data, var, ranked_questions, counter)
```

```{r}
var <- categories_best_to_worst[var_counter]; var_counter <- var_counter + 1
```

\newpage  

\centering  

## `r var`

\raggedright  
**Employees' agreement and disagreement with each statement.**
```{r, fig.align='center', fig.height = 1.3, results='asis'}

melted_count_data <- melt_data(df_props, col_cats, categories, var)

outputs <- plot_strengths_and_weaknesses(melted_count_data)
ranked_questions <- outputs[[1]]
ns <- outputs[[2]]
```
**Average response profile across all statements in this category.**
**Lines represent the range of individual statements.**
```{r}
histo_error_bars <- melted_count_data %>% group_by(response) %>%
  summarize(min = min(value), max = max(value)) %>% as.data.frame()

plot_histogram_large(df_count_cats, histo_error_bars, var)
```
\newpage

```{r, results='asis'}
if(ns[1] > 0){cat(paste("**Clear Agreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[1], melted_count_data, var, ranked_questions)
```

```{r, results='asis'}
if(ns[2] > 0){cat(paste("**Slight Agreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[2], melted_count_data, var, ranked_questions, counter)
```

```{r, results='asis'}
if(ns[3] > 0){cat(paste("**Neutral** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[3], melted_count_data, var, ranked_questions, counter)
```

```{r, results='asis'}
if(ns[4] > 0){cat(paste("**Slight Disagreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[4], melted_count_data, var, ranked_questions, counter)
```

```{r, results='asis'}
if(ns[5] > 0){cat(paste("**Clear Disagreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[5], melted_count_data, var, ranked_questions, counter)
```

```{r}
var <- categories_best_to_worst[var_counter]; var_counter <- var_counter + 1
```

\newpage  

\centering  

## `r var`

\raggedright  
**Employees' agreement and disagreement with each statement.**
```{r, fig.align='center', fig.height = 1.3, results='asis'}

melted_count_data <- melt_data(df_props, col_cats, categories, var)

outputs <- plot_strengths_and_weaknesses(melted_count_data)
ranked_questions <- outputs[[1]]
ns <- outputs[[2]]
```
**Average response profile across all statements in this category.**
**Lines represent the range of individual statements.**
```{r}
histo_error_bars <- melted_count_data %>% group_by(response) %>%
  summarize(min = min(value), max = max(value)) %>% as.data.frame()

plot_histogram_large(df_count_cats, histo_error_bars, var)
```
\newpage

```{r, results='asis'}
if(ns[1] > 0){cat(paste("**Clear Agreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[1], melted_count_data, var, ranked_questions)
```

```{r, results='asis'}
if(ns[2] > 0){cat(paste("**Slight Agreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[2], melted_count_data, var, ranked_questions, counter)
```

```{r, results='asis'}
if(ns[3] > 0){cat(paste("**Neutral** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[3], melted_count_data, var, ranked_questions, counter)
```

```{r, results='asis'}
if(ns[4] > 0){cat(paste("**Slight Disagreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[4], melted_count_data, var, ranked_questions, counter)
```

```{r, results='asis'}
if(ns[5] > 0){cat(paste("**Clear Disagreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[5], melted_count_data, var, ranked_questions, counter)
```

```{r}
var <- categories_best_to_worst[var_counter]; var_counter <- var_counter + 1
```

\newpage  

\centering  

## `r var`

\raggedright  
**Employees' agreement and disagreement with each statement.**
```{r, fig.align='center', fig.height = 1.3, results='asis'}

melted_count_data <- melt_data(df_props, col_cats, categories, var)

outputs <- plot_strengths_and_weaknesses(melted_count_data)
ranked_questions <- outputs[[1]]
ns <- outputs[[2]]
```
**Average response profile across all statements in this category.**
**Lines represent the range of individual statements.**
```{r}
histo_error_bars <- melted_count_data %>% group_by(response) %>%
  summarize(min = min(value), max = max(value)) %>% as.data.frame()

plot_histogram_large(df_count_cats, histo_error_bars, var)
```
\newpage

```{r, results='asis'}
if(ns[1] > 0){cat(paste("**Clear Agreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[1], melted_count_data, var, ranked_questions)
```

```{r, results='asis'}
if(ns[2] > 0){cat(paste("**Slight Agreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[2], melted_count_data, var, ranked_questions, counter)
```

```{r, results='asis'}
if(ns[3] > 0){cat(paste("**Neutral** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[3], melted_count_data, var, ranked_questions, counter)
```

```{r, results='asis'}
if(ns[4] > 0){cat(paste("**Slight Disagreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[4], melted_count_data, var, ranked_questions, counter)
```

```{r, results='asis'}
if(ns[5] > 0){cat(paste("**Clear Disagreement** - ", var,sep=""))}
```

```{r, fig.height = 2}
counter <- plot_histo_loop(ns[5], melted_count_data, var, ranked_questions, counter)
```

```{r}
var <- categories_best_to_worst[var_counter]; var_counter <- var_counter + 1
```

\newpage  

\centering  

